plugins {
    `java-library`
    `maven-publish`
}

group = "me.xginko.aef"
version = "2.7.0-SNAPSHOT"
description = "Prevent many exploits that affect anarchy servers."
var url: String? = "github.com/xGinko/AnarchyExploitFixes"

repositories {
    mavenCentral()

    maven {
        name = "papermc-repo"
        url = uri("https://repo.papermc.io/repository/maven-public/")
    }

    maven {
        name = "codemc-repo"
        url = uri("https://repo.codemc.io/repository/maven-public/")
    }

    maven {
        name = "nms-repo"
        url = uri("https://repo.codemc.io/repository/nms/")
    }

    maven {
        name = "configmaster-repo"
        url = uri("https://ci.pluginwiki.us/plugin/repository/everything/")
    }

    maven {
        name = "aikar-repo"
        url = uri("https://repo.aikar.co/content/groups/aikar/")
    }

    maven {
        name = "jitpack.io"
        url = uri("https://jitpack.io")
    }
}

dependencies {
    api("com.github.thatsmusic99:ConfigurationMaster-API:v2.0.0-rc.1") // ConfigurationMaster for enhanced config management
    compileOnly("com.github.retrooper.packetevents:spigot:2.3.0") // PacketEvents to patch packet based exploits
    api("de.tr7zw:item-nbt-api:2.12.4") // NBT API for cross version nbt tag handling
    api("io.papermc:paperlib:1.0.8") // Useful Paper related tools
    api("org.bstats:bstats-bukkit:3.0.2") // Bukkit bStats
    api("org.apache.commons:commons-math3:3.6.1") // FastMath
    api("com.ibm.icu:icu4j:75.1") // Rule based number format used in first join messages to format to ordinal based on locale
    api("org.reflections:reflections:0.10.2") // Reflections
    compileOnly("org.apache.logging.log4j:log4j-core:2.23.1")
}

tasks.withType<JavaCompile>() {
    options.encoding = "UTF-8"
}

tasks.withType<Javadoc>() {
    options.encoding = "UTF-8"
}

tasks.build.configure {
    dependsOn("shadowJar")
}

tasks {
    processResources {
        filesMatching("**/plugin.yml") {
            expand(
                "version" to project.version,
                "description" to project.description,
                "url" to url
            )
        }
    }
}

publishing {
    publications.create<MavenPublication>("maven") {
        from(components["java"])
    }
}
