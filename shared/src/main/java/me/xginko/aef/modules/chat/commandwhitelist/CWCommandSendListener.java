package me.xginko.aef.modules.chat.commandwhitelist;

import me.xginko.aef.enums.AEFPermission;
import org.bukkit.event.EventHandler;
import org.bukkit.event.EventPriority;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerCommandSendEvent;

import java.util.Set;

public class CWCommandSendListener implements Listener {

    private final Set<String> allowedCommands;
    private static boolean isSupported;

    static {
        try {
            Class.forName("org.bukkit.event.player.PlayerCommandSendEvent");
            isSupported = true;
        } catch (ClassNotFoundException e) {
            isSupported = false;
        }
    }

    public CWCommandSendListener(Set<String> allowedCommands) {
        this.allowedCommands = allowedCommands;
    }

    @EventHandler(priority = EventPriority.HIGHEST, ignoreCancelled = true)
    private void onInitialTabCompleteListSend(PlayerCommandSendEvent event) {
        if (!event.getPlayer().hasPermission(AEFPermission.BYPASS_CMD_WHITELIST.bukkit())) {
            event.getCommands().retainAll(allowedCommands);
        }
    }

    public static boolean isSupported() {
        return isSupported;
    }
}
